{"nbformat":4,"nbformat_minor":0,"metadata":{"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.7.3"},"colab":{"name":"Competition1-Senence classification3-pretrained embedding.ipynb","provenance":[],"collapsed_sections":[]},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"6c2bac26e88449249ab56ba56a6fbd8f":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_b17840bdf2a04da49a4da078848b4e3e","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_edde3af37fa246f18621aa18a5587f3d","IPY_MODEL_3c02690f6560407a984f90b367d0a315"]}},"b17840bdf2a04da49a4da078848b4e3e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"edde3af37fa246f18621aa18a5587f3d":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_e90df9fe18214bfb8d18873258ddcf7e","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"success","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":197,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_079a46ccb7ca470a8bbd37f368e19bf1"}},"3c02690f6560407a984f90b367d0a315":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_1f344c99a49b4dbd9a5b5933d7b8d159","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 197/197 [00:47&lt;00:00,  4.23it/s, f1=0.23784, loss=0.238]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_f3d7c8ff77b74b579bc1549977afb615"}},"e90df9fe18214bfb8d18873258ddcf7e":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"079a46ccb7ca470a8bbd37f368e19bf1":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"1f344c99a49b4dbd9a5b5933d7b8d159":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"f3d7c8ff77b74b579bc1549977afb615":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"e5b8370dbd2048c9b2243cf0f66f6079":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_53b698ecb1c74c0fbcb532c713879880","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_eefcb4123f534d5297a5de5c7c69f2bf","IPY_MODEL_69834bc132fc4dcba6d2c752613238b2"]}},"53b698ecb1c74c0fbcb532c713879880":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"eefcb4123f534d5297a5de5c7c69f2bf":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_56384113d4c046c0a6c7515c7fb3f688","_dom_classes":[],"description":"Valid","_model_name":"IntProgressModel","bar_style":"success","max":22,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":22,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_f99a7d0e83314718979337a20137e6fd"}},"69834bc132fc4dcba6d2c752613238b2":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_41b8d351482647de85508de9563fb9c4","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 22/22 [00:01&lt;00:00, 12.84it/s, f1=0.53950, loss=0.173]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_789cb4744bd04dcfbbc257b34d6992b2"}},"56384113d4c046c0a6c7515c7fb3f688":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"f99a7d0e83314718979337a20137e6fd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"41b8d351482647de85508de9563fb9c4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"789cb4744bd04dcfbbc257b34d6992b2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"565d48d2b06c44d78cea1128176c3636":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_a01e4b1190bd486cae30f5fae125514a","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_bf5692f8e0e74b87bec19e556512c09f","IPY_MODEL_ac4bf2cb09a347fc8150e0a8497a1592"]}},"a01e4b1190bd486cae30f5fae125514a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"bf5692f8e0e74b87bec19e556512c09f":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_8bce549a3b644ff4ac8bd68f5b1ecd7b","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"success","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":197,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_e616847924c7407b863e589c2cda3023"}},"ac4bf2cb09a347fc8150e0a8497a1592":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_30a9b8c2c49141a7a2b700b07f176944","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 197/197 [00:47&lt;00:00,  4.44it/s, f1=0.61389, loss=0.167]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_071818c70d2b48fab71ad5fbc4ef4177"}},"8bce549a3b644ff4ac8bd68f5b1ecd7b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"e616847924c7407b863e589c2cda3023":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"30a9b8c2c49141a7a2b700b07f176944":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"071818c70d2b48fab71ad5fbc4ef4177":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"73877f5755a0412ea5afe736fa7f0492":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_60d4cc05d4294616aec963542da06550","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_5fe23da65850432b8bc5e357f440e808","IPY_MODEL_d4907559ee444cb3b2a9dabb36fd85f1"]}},"60d4cc05d4294616aec963542da06550":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"5fe23da65850432b8bc5e357f440e808":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_2afb173a6de241eba3c6b3b9bda31cc7","_dom_classes":[],"description":"Valid","_model_name":"IntProgressModel","bar_style":"success","max":22,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":22,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_71ff5b9c8e6a4118a04bbf2fd44d82bf"}},"d4907559ee444cb3b2a9dabb36fd85f1":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_a96caa803c5049c88e4c82db2516ef7f","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 22/22 [00:01&lt;00:00, 12.77it/s, f1=0.67092, loss=0.152]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_97ed13638c744cc2b9a467762e0cb54d"}},"2afb173a6de241eba3c6b3b9bda31cc7":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"71ff5b9c8e6a4118a04bbf2fd44d82bf":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a96caa803c5049c88e4c82db2516ef7f":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"97ed13638c744cc2b9a467762e0cb54d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"74cbef6e708041f8aaec1d7d04483b96":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_0001c23f91064c33992ccca9917af115","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_dd581818b4014cc2add3cd1118e64149","IPY_MODEL_b68e3791cef74fb2a9f77870e74a0092"]}},"0001c23f91064c33992ccca9917af115":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"dd581818b4014cc2add3cd1118e64149":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_1d4096620d144617ad61e0d02b117670","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"success","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":197,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_ff558b286b7747edba0a6b646a1b0695"}},"b68e3791cef74fb2a9f77870e74a0092":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_0f1b6808c5094e4999300620d3b1aff1","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 197/197 [00:47&lt;00:00,  4.46it/s, f1=0.66978, loss=0.152]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_152b077ac53f491bb7f31f074c92faa9"}},"1d4096620d144617ad61e0d02b117670":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"ff558b286b7747edba0a6b646a1b0695":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"0f1b6808c5094e4999300620d3b1aff1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"152b077ac53f491bb7f31f074c92faa9":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a89c5bf642b54278a423536284eba9c7":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_a147f61abb684e238d3c4f25f7aa1c50","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_22d76fa1cabd4a7d9da3a9e9f2c32165","IPY_MODEL_622b9fd9f4a34f50b562ef640eecd996"]}},"a147f61abb684e238d3c4f25f7aa1c50":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"22d76fa1cabd4a7d9da3a9e9f2c32165":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_ebf552e1d93f42df8dc5d49bad97bca8","_dom_classes":[],"description":"Valid","_model_name":"IntProgressModel","bar_style":"success","max":22,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":22,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_1bebc95da0814edc94fe60fffec313a0"}},"622b9fd9f4a34f50b562ef640eecd996":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_36fd4c69923d413287aeaf605388b5d6","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 22/22 [00:01&lt;00:00, 12.63it/s, f1=0.68467, loss=0.145]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_b849d35b38a147998636db976f2d53b6"}},"ebf552e1d93f42df8dc5d49bad97bca8":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"1bebc95da0814edc94fe60fffec313a0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"36fd4c69923d413287aeaf605388b5d6":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"b849d35b38a147998636db976f2d53b6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"936d0488d910458aad521dab2f9f6ec9":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_c99b676ec00f494599ec00392bb17623","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_b720e367530844f38129b5903e4652e8","IPY_MODEL_d615f80323a74ab4bef38f15870299ec"]}},"c99b676ec00f494599ec00392bb17623":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"b720e367530844f38129b5903e4652e8":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_f25e73027a664c759cd31a77a7c1b6c6","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"success","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":197,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_aedcb940f7be45f9a88d5442dbab0769"}},"d615f80323a74ab4bef38f15870299ec":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_af10da4682aa4bdd9be21de9b4209720","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 197/197 [00:46&lt;00:00,  4.38it/s, f1=0.69504, loss=0.143]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_75f2c59651354d2696ac36681af66757"}},"f25e73027a664c759cd31a77a7c1b6c6":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"aedcb940f7be45f9a88d5442dbab0769":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"af10da4682aa4bdd9be21de9b4209720":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"75f2c59651354d2696ac36681af66757":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"b588f65c468a4e37bca2fdea8bf25117":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_ecbf6f6a38114c4f8416ef470f43dbc6","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_41045615d2074988b2bc659af05e3067","IPY_MODEL_20317e56aca94a8ba8fecb9511ab471d"]}},"ecbf6f6a38114c4f8416ef470f43dbc6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"41045615d2074988b2bc659af05e3067":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_5907b68058da42f59fd4d52ec9ca0fdd","_dom_classes":[],"description":"Valid","_model_name":"IntProgressModel","bar_style":"success","max":22,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":22,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_2569f35e9bf34113a4870c7ee02a3bb7"}},"20317e56aca94a8ba8fecb9511ab471d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_bd135357d92b4aa3bc0d3cec64eff896","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 22/22 [00:01&lt;00:00, 12.92it/s, f1=0.68193, loss=0.146]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_a0b4d7d5508b4caa935dd07ea68c53bd"}},"5907b68058da42f59fd4d52ec9ca0fdd":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"2569f35e9bf34113a4870c7ee02a3bb7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"bd135357d92b4aa3bc0d3cec64eff896":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"a0b4d7d5508b4caa935dd07ea68c53bd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"b49568217d46478b913ae65b7074ac20":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_3a99d05ea8114b6281428a23b4c401cd","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_b312812a1c034ec89e53bd3e6c7651d8","IPY_MODEL_6ad4909e79ac4b34be90dbd1d8040107"]}},"3a99d05ea8114b6281428a23b4c401cd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"b312812a1c034ec89e53bd3e6c7651d8":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_508208bc34834b559791e72ae8612a1e","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"success","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":197,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_59bfc43be396498ca6e2826911d0eb12"}},"6ad4909e79ac4b34be90dbd1d8040107":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_185060860e194e19ad65fa12d7e6009b","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 197/197 [00:46&lt;00:00,  4.16it/s, f1=0.71365, loss=0.137]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_5069114a7c4a4a2a9ccd12d0c7257f37"}},"508208bc34834b559791e72ae8612a1e":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"59bfc43be396498ca6e2826911d0eb12":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"185060860e194e19ad65fa12d7e6009b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"5069114a7c4a4a2a9ccd12d0c7257f37":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"8cd8c29b8fc94f60b509826a41b34a20":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_76fc90e1f9ac41c581895e4b932e62fe","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_426537dcdb124a5bb09c5753df816f7a","IPY_MODEL_f19490a09c7c442a815dff3165609f0f"]}},"76fc90e1f9ac41c581895e4b932e62fe":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"426537dcdb124a5bb09c5753df816f7a":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_1f5c63b630bd4edaadedd77189490ae4","_dom_classes":[],"description":"Valid","_model_name":"IntProgressModel","bar_style":"success","max":22,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":22,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_9f0d5838cb7d4f8cb36baf9900f0ec52"}},"f19490a09c7c442a815dff3165609f0f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_ceb3f0b2348e49ba9e999f1460d1a818","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 22/22 [00:01&lt;00:00, 12.67it/s, f1=0.68638, loss=0.146]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_f16a511e59c4464aa6142e8dd4b75309"}},"1f5c63b630bd4edaadedd77189490ae4":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"9f0d5838cb7d4f8cb36baf9900f0ec52":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"ceb3f0b2348e49ba9e999f1460d1a818":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"f16a511e59c4464aa6142e8dd4b75309":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"1ce607689bf04fb997332aa804f59048":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_f14e184a23304789a7e4fe51b7c9d068","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_4c9defaf14da44e087e50b041b0a6571","IPY_MODEL_8c068285b4d64a2eb9980ffeb4a030ef"]}},"f14e184a23304789a7e4fe51b7c9d068":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"4c9defaf14da44e087e50b041b0a6571":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_310dda17c34546728c49a665553f79c5","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"success","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":197,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_4c8824866b6f4c9c8de467b8556c2b7f"}},"8c068285b4d64a2eb9980ffeb4a030ef":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_aaa9ca9a0aed45cd9814cc44ed5a5fa6","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 197/197 [00:46&lt;00:00,  4.31it/s, f1=0.73595, loss=0.128]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_aa2d942d6fcf4a7688b353f62567db4c"}},"310dda17c34546728c49a665553f79c5":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"4c8824866b6f4c9c8de467b8556c2b7f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"aaa9ca9a0aed45cd9814cc44ed5a5fa6":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"aa2d942d6fcf4a7688b353f62567db4c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"4ab72a76acd641ec87464e26546a34f9":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_b40d84606ed3450a935b9e3de9eb8a2d","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_f69a35e8fbeb4dedb1dcc5af5e523f57","IPY_MODEL_a832431821cd4643aa3d0bd2f3bb764e"]}},"b40d84606ed3450a935b9e3de9eb8a2d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"f69a35e8fbeb4dedb1dcc5af5e523f57":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_642a3dd1988b4ef3a2c28a9bdc3ebc8a","_dom_classes":[],"description":"Valid","_model_name":"IntProgressModel","bar_style":"success","max":22,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":22,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_bc229923548b40408ec9ab6a644a655b"}},"a832431821cd4643aa3d0bd2f3bb764e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_574cd010c6c847cbb126701a8bffaf24","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"100% 22/22 [00:01&lt;00:00, 12.59it/s, f1=0.67449, loss=0.15]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_6c64057d10454a0aa9309ea68221e90d"}},"642a3dd1988b4ef3a2c28a9bdc3ebc8a":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"bc229923548b40408ec9ab6a644a655b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"574cd010c6c847cbb126701a8bffaf24":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"6c64057d10454a0aa9309ea68221e90d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"50dd3ef0393a4e2fad0ae592d4e6aae4":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_e26ec58fd196481cb6bc065253b85903","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_0c5661bdafc643dabd7676a090b7b8fb","IPY_MODEL_420fc08e370442d1b09dac836bb716d0"]}},"e26ec58fd196481cb6bc065253b85903":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"0c5661bdafc643dabd7676a090b7b8fb":{"model_module":"@jupyter-widgets/controls","model_name":"IntProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_27d267887e7b4556bbe0284ae3be50df","_dom_classes":[],"description":"Train","_model_name":"IntProgressModel","bar_style":"danger","max":197,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":192,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_87d1e81d2f4f462e96660dbcdcc45f02"}},"420fc08e370442d1b09dac836bb716d0":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_63a553655f2744c68b0b5f864dc50c55","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 97% 192/197 [00:44&lt;00:01,  4.07it/s, f1=0.75925, loss=0.118]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_768b8dbe2c3a451b9bcdc6380686c055"}},"27d267887e7b4556bbe0284ae3be50df":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"87d1e81d2f4f462e96660dbcdcc45f02":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"63a553655f2744c68b0b5f864dc50c55":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"768b8dbe2c3a451b9bcdc6380686c055":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"pErN114hmUxF","colab_type":"text"},"source":["**人工智慧論文機器閱讀競賽之論文分類(Tagging of Thesis)**\n"]},{"cell_type":"markdown","metadata":{"id":"vKKaZjNvOIM7","colab_type":"text"},"source":["**Connect with Google Drive**"]},{"cell_type":"code","metadata":{"id":"PGNK9ayzV7DP","colab_type":"code","outputId":"4bbea86a-d5ab-4263-98df-a44cef771005","executionInfo":{"status":"ok","timestamp":1577299518692,"user_tz":-480,"elapsed":2540,"user":{"displayName":"連國安","photoUrl":"https://lh3.googleusercontent.com/a-/AAuE7mBta7TGONYMKlH0SwAU74zZeMlrtHkQOqtiMoev=s64","userId":"12863169965973415180"}},"colab":{"base_uri":"https://localhost:8080/","height":54}},"source":["from google.colab import drive\n","drive.mount('/content/gdrive')"],"execution_count":2,"outputs":[{"output_type":"stream","text":["Drive already mounted at /content/gdrive; to attempt to forcibly remount, call drive.mount(\"/content/gdrive\", force_remount=True).\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"0tBbrUr2jzrz","colab_type":"code","colab":{}},"source":["dataPath = '/content/gdrive/My Drive/Colab Notebooks/AICUP2019/'"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"TboUaYpis3wb","colab_type":"text"},"source":["**Data processing**  "]},{"cell_type":"markdown","metadata":{"id":"yJxx0Tp_s3wc","colab_type":"text"},"source":["**刪除多餘資訊 (Remove redundant information)**  \n","我們在資料集中保留了許多額外資訊供大家使用，但是在這次的教學中我們並沒有用到全部資訊，因此先將多餘的部分刪除。  \n","In dataset, we reserved lots of information. But the mtehod we use in this tutorial doesn't need them, so let's delete it."]},{"cell_type":"code","metadata":{"id":"NLc_q3TTs3wc","colab_type":"code","colab":{}},"source":["# import pandas as pd\n","# dataset = pd.read_csv(dataPath+'task1_trainset.csv', dtype=str)\n","# dataset.drop('Title', axis=1, inplace=True)\n","# dataset.drop('Categories', axis=1, inplace=True)\n","# dataset.drop('Created Date', axis=1, inplace=True)\n","# dataset.drop('Authors', axis=1, inplace=True)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"LWRHoNZ6s3wi","colab_type":"text"},"source":["**資料切割  (Partition)**  \n","在訓練時，我們需要有個方法去檢驗訓練結果的好壞，因此需要將訓練資料切成training/validataion set。   \n","While training, we need some method to exam our model's performance, so we divide our training data into training/validation set."]},{"cell_type":"code","metadata":{"id":"YpEkdlTYs3wj","colab_type":"code","colab":{}},"source":["# from sklearn.utils import shuffle\n","# from sklearn.model_selection import train_test_split\n","# trainset, validset = train_test_split(dataset, test_size=0.1, random_state=42)\n","\n","# trainset.to_csv(dataPath+'trainset.csv', index=False)\n","# validset.to_csv(dataPath+'validset.csv', index=False)"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"gWsCqgZfs3wl","colab_type":"code","colab":{}},"source":["# # Do the same things for test data\n","# dataset = pd.read_csv(dataPath+'task1_public_testset.csv', dtype=str)\n","# dataset.drop('Title', axis=1, inplace=True)\n","# dataset.drop('Categories', axis=1, inplace=True)\n","# dataset.drop('Created Date', axis=1, inplace=True)\n","# dataset.drop('Authors', axis=1, inplace=True)\n","# dataset.to_csv(dataPath+'testset.csv', index=False)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"NP4cP79Xs3wn","colab_type":"text"},"source":["**統計單字 (Count words)：只用trainset**  \n","在訓練時，不能直接將單字直接餵入model，因為它只看得懂數字，因此我們必須把所有的單字抽取出來，並將它們打上編號，做出一個字典來對它們做轉換。\n","We can't feed \"word\" into model directly, since it can only recognize number. So, we need to know the total number of word, and give every word a unique number.  \n","在這裡，我們需要借助`nltk`這個library來幫忙做文字切割。當然，你也可以選擇自己寫規則來切割(通常上不建議搞死自己)。  \n","In here, we split words by using `nltk library`. You can write your own rules and split it by yourself, but you won't want to do that, trust me.  "]},{"cell_type":"code","metadata":{"id":"VSYXklWwfVUA","colab_type":"code","colab":{}},"source":["# # colab doesn't have all package in nltk, we need to download by ourselves.\n","# import nltk\n","# nltk.download('punkt')"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"zxM2Mi8efHcg","colab_type":"code","colab":{}},"source":["# import numpy as np\n","# import pandas as pd\n","# from nltk.tokenize import word_tokenize"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"iW6Wyv9ZuF7j","colab_type":"code","colab":{}},"source":["# def collect_words(data_path):\n","#   df = pd.read_csv(data_path, dtype=str)\n","\n","#   tokens = set()\n","#   for i in df.iterrows():\n","#     sents  = i[1]['Abstract'].split('$$$')     # i[0]為dataframe產生之index\n","#     sents = ' '.join(sents)     # 句子間從$$$變成空格 來分開，以便word_tokenize運作\n","#     tokens |= set(word_tokenize(sents))     # 去除重複、聯集\n","#   return tokens"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"MIZf3cwIs3ws","colab_type":"code","colab":{}},"source":["# words = set()\n","# words |= collect_words(dataPath+'trainset.csv')"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"Jq3sPOxls3wu","colab_type":"text"},"source":["**建立字典 (Building Dictionary)**  \n","Given every word a unique index.\n","```\n","pad: for padding  \n","unk: for word that not in our dicitonary(unknown)\n","```\n","\n"]},{"cell_type":"code","metadata":{"id":"HcoIEQdOs3wv","colab_type":"code","colab":{}},"source":["# PAD_TOKEN = 0\n","# UNK_TOKEN = 1\n","# word_dict = {'<pad>': PAD_TOKEN, '<unk>': UNK_TOKEN}\n","# # 依序編碼\n","# for word in words:\n","#   word_dict[word] = len(word_dict)"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"T2uZ7ziUs3ww","colab_type":"code","colab":{}},"source":["# # 將字典存起來，以後就不用再做一次\n","# import pickle\n","# with open(dataPath+'dicitonary.pkl', 'wb') as f:\n","#   pickle.dump(word_dict, f)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"SILvO7c8Vy2v","colab_type":"text"},"source":["**重複跑的時候，只需要執行1.2(連結google雲端硬碟) + 以下引用及打開檔案即可**"]},{"cell_type":"code","metadata":{"id":"Hx1SCCsQ2YE1","colab_type":"code","outputId":"396388f8-fc3d-4580-fc55-54e7afbf7b6b","executionInfo":{"status":"ok","timestamp":1577299528904,"user_tz":-480,"elapsed":12687,"user":{"displayName":"連國安","photoUrl":"https://lh3.googleusercontent.com/a-/AAuE7mBta7TGONYMKlH0SwAU74zZeMlrtHkQOqtiMoev=s64","userId":"12863169965973415180"}},"colab":{"base_uri":"https://localhost:8080/","height":51}},"source":["import nltk\n","nltk.download('punkt')\n","\n","import numpy as np\n","import pandas as pd\n","from nltk.tokenize import word_tokenize\n","\n","trainset = pd.read_csv(dataPath+'trainset.csv', dtype=str)\n","validset = pd.read_csv(dataPath+'validset.csv', dtype=str)\n","testset = pd.read_csv(dataPath+'testset.csv', dtype=str)\n","\n","\n","PAD_TOKEN = 0\n","UNK_TOKEN = 1\n","\"\"\"\n","load word dictionary\n","要重複跑載入字典\n","\"\"\"\n","import pickle\n","with open(dataPath+'dicitonary.pkl', 'rb') as f:\n","  word_dict = pickle.load(f)\n","'''\n","載入words\n","'''\n","words = set(word_dict.keys())"],"execution_count":13,"outputs":[{"output_type":"stream","text":["[nltk_data] Downloading package punkt to /root/nltk_data...\n","[nltk_data]   Unzipping tokenizers/punkt.zip.\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"8FITuZqM6kbb","colab_type":"text"},"source":["## Embedding class to save pretrained embedding"]},{"cell_type":"code","metadata":{"id":"FGhiT4JQVvqd","colab_type":"code","colab":{}},"source":["import re\n","import torch\n","\n","class Embedding:\n","  \"\"\"\n","  Args:\n","      embedding_path (str): Path where embedding are loaded from (text file).\n","      words (None or list): If not None, only load embedding of the words in the list. # trainset蒐集的單字\n","      # out of vocabulary=True 沒在glove就視為 <unk>；False 沒在glove隨機初始化向量，加入字典 + embedding\n","      oov_as_unk (bool): If argument `words` are provided, whether or not treat \n","          words in `words` but not in embedding file as `<unk>`. If\n","          true, OOV will be mapped to the index of `<unk>`. Otherwise,\n","          embedding of those OOV will be randomly initialize and their\n","          indices will be after non-OOV.\n","      lower (bool): Whether or not lower the words.\n","      rand_seed (int): Random seed for embedding initialization.\n","  \"\"\"\n","\n","  def __init__(self, embedding_path, words=None, oov_as_unk=True, lower=True, rand_seed=524):\n","    self.word_dict = {}     # 字典：{字: 依len順序編號}\n","    self.vectors = None     # 字向量矩陣\n","    self.lower = lower     # 是否變小寫\n","    self.extend(embedding_path, words, oov_as_unk)\n","    torch.manual_seed(rand_seed)     # 固定random seed\n","\n","    if '<pad>' not in self.word_dict:     # tensor([0., 0., 0. ...維度])\n","      self.add('<pad>', torch.zeros(self.get_dim()))\n","    \n","    if '<bos>' not in self.word_dict:     # e.g. tensor([[0.5968, 0.2361, 0.4413, ...維度]])\n","      t_tensor = torch.rand((1, self.get_dim()), dtype=torch.float)\n","      torch.nn.init.orthogonal_(t_tensor)     # 正交初始化(使t_tensor是正交的)\n","      self.add('<bos>', t_tensor)\n","        \n","    if '<eos>' not in self.word_dict:\n","      t_tensor = torch.rand((1, self.get_dim()), dtype=torch.float)\n","      torch.nn.init.orthogonal_(t_tensor)\n","      self.add('<eos>', t_tensor)\n","    \n","    if '<unk>' not in self.word_dict:\n","      self.add('<unk>')\n","\n","  def to_index(self, word):\n","    \"\"\"\n","    Args:\n","        word (str)\n","    Return:\n","        index of the word. If the word is not in `words` and not in the\n","        embedding file, then index of `<unk>` will be returned.\n","    \"\"\"\n","    if self.lower:\n","      word = word.lower()\n","\n","    if word not in self.word_dict:\n","      return self.word_dict['<unk>']\n","    else:\n","      return self.word_dict[word]\n","\n","  def get_dim(self):     # 向量維度\n","    return self.vectors.shape[1]\n","\n","  def get_vocabulary_size(self):     # 字彙數量\n","    return self.vectors.shape[0]\n","\n","  def add(self, word, vector=None):\n","    if self.lower:\n","      word = word.lower()\n","\n","    if vector is not None:     # 該字有向量轉成(1, dim)\n","      vector = vector.view(1, -1)\n","    else:     # 該字沒向量：隨機初始化，均勻分配\n","      vector = torch.empty(1, self.get_dim())\n","      torch.nn.init.uniform_(vector)     # 預設a=0, b=1\n","    self.vectors = torch.cat([self.vectors, vector], 0)     # 0維，沿著垂直方向，向下疊加\n","    self.word_dict[word] = len(self.word_dict)     # 字典依據長度編號\n","\n","  def extend(self, embedding_path, words, oov_as_unk=True):     # oov_as_unk=False 沒在glove隨機初始化向量，加入字典 + embedding\n","    self._load_embedding(embedding_path, words)\n","\n","    if words is not None and not oov_as_unk:\n","      # initialize word vector for OOV\n","      for word in words:\n","        if self.lower:\n","          word = word.lower()\n","        # 加到def字典\n","        if word not in self.word_dict:\n","          self.word_dict[word] = len(self.word_dict)\n","      # 加入向量\n","      oov_vectors = torch.nn.init.uniform_(torch.empty(len(self.word_dict) - self.vectors.shape[0], \n","                                                       self.vectors.shape[1]))\n","      self.vectors = torch.cat([self.vectors, oov_vectors], 0)\n","\n","  def _load_embedding(self, embedding_path, words):\n","    if words is not None:\n","      words = set(words)\n","    vectors = []\n","\n","    with open(embedding_path) as fp:\n","      row1 = fp.readline()\n","      # if the first row is not header(1次以上數字開頭, 1次以上數字結尾)\n","      if not re.match('^[0-9]+ [0-9]+$', row1):\n","        # seek to 0\n","        fp.seek(0)\n","      # otherwise ignore the header\n","\n","      for i, line in enumerate(fp):     # 逐字讀取\n","        cols = line.rstrip().split(' ')     # 用空格切開\n","        word = cols[0]      # index=0為該字，後面是向量\n","\n","        # skip word not in words if words are provided      # glove裡面的字 沒有在 trainset蒐集的單字內\n","        if words is not None and word not in words:\n","          continue\n","        elif word not in self.word_dict:     # glove與trainset蒐集的單字 交集 → 沒在def的字典內 就加進去 def字典、向量集\n","          self.word_dict[word] = len(self.word_dict)\n","          vectors.append([float(v) for v in cols[1:]])\n","    # 存向量到self.vectors\n","    vectors = torch.tensor(vectors)\n","    if self.vectors is not None:\n","      self.vectors = torch.cat([self.vectors, vectors], dim=0)\n","    else:\n","      self.vectors = vectors"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"Hma-6zDtgmdw","colab_type":"code","colab":{}},"source":["# # download Glove pretrained word embedding from web. + save\n","# embedder = Embedding(dataPath+'glove.6B.300d.txt', words)\n","\n","# with open(dataPath+'embedding.pkl', 'wb') as f:\n","#   pickle.dump(embedder, f)\n","\n","with open(dataPath+'embedding.pkl', 'rb') as f:\n","  embedder = pickle.load(f)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"R6XU5T-Ls3wy","colab_type":"text"},"source":["**資料格式化 (Data formatting)**  \n","有了字典後，接下來我們要把資料整理成一筆一筆，把input的句子轉成數字，把答案轉成onehot的形式。  \n","After building dictionary, that's mapping our sentences into number array, and convert answers to onehot format.  "]},{"cell_type":"code","metadata":{"id":"3cV1auaUs3wz","colab_type":"code","colab":{}},"source":["def get_dataset(data_path, word_dict, n_workers=4):\n","  \"\"\" Load data and return dataset for training and validating.\n","\n","  Args:\n","      data_path (str): Path to the data.\n","  Return:\n","      output (list of dict): [dict, dict, dict ...]\n","  \"\"\"\n","  dataset = pd.read_csv(data_path, dtype=str)\n","  formatData = []\n","  # for loop 取出每一篇\n","  for (idx, data) in dataset.iterrows():\n","    \"\"\"\n","    processed: {\n","      'Abstract': [[4, 5, 6], [3, 4, 2], ...]\n","      'Label': [[0, 0, 0, 1, 1, 0], [1, 0, 0, 0, 1, 0], ...]\n","    }\n","    \"\"\"\n","    processed = {}\n","    processed['Abstract'] = [sentence_to_indices(sent, word_dict) for sent in data['Abstract'].split('$$$')]\n","    if 'Task 1' in data:\n","      processed['Label'] = [label_to_onehot(label) for label in data['Task 1'].split(' ')]\n","    formatData.append(processed)\n","  \n","  return formatData\n","# 分類結果label(Task 1)用onehot表示(labels為每篇的每個句子之分類)-y\n","  # 每個句子的分類以 **空格** 分開，同個句子多個分類以 **/** 分開\n","def label_to_onehot(labels):\n","  \"\"\" Convert label to onehot .\n","      Args:\n","          labels (string): sentence's labels.\n","      Return:\n","          outputs (onehot list): sentence's onehot label.\n","  \"\"\"\n","  label_dict = {'BACKGROUND': 0, 'OBJECTIVES': 1, 'METHODS': 2, 'RESULTS': 3, 'CONCLUSIONS': 4, 'OTHERS': 5}\n","  onehot = [0, 0, 0, 0, 0, 0]\n","  # 同一句多分類切割後為['類1', '類2', ..., '類6']，有的話就1\n","  for l in labels.split('/'):\n","    onehot[label_dict[l]] = 1\n","  return onehot\n","# 每句將字取出，利用已儲存的字典 轉成編碼-X\n","def sentence_to_indices(sentence, word_dict):\n","  \"\"\" Convert sentence to its word indices.\n","  Args:\n","      sentence (str): One string.\n","  Return:\n","      indices (list of int): List of word indices.\n","  \"\"\"\n","  return [word_dict.to_index(word) for word in word_tokenize(sentence)]     # -----改掉[word_dict.get(word, UNK_TOKEN) ...]-----"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"scrolled":true,"id":"ADwpeAfas3w1","colab_type":"code","outputId":"f55c40fa-7b3f-4532-a909-4697a1282e47","executionInfo":{"status":"ok","timestamp":1577299570687,"user_tz":-480,"elapsed":54449,"user":{"displayName":"連國安","photoUrl":"https://lh3.googleusercontent.com/a-/AAuE7mBta7TGONYMKlH0SwAU74zZeMlrtHkQOqtiMoev=s64","userId":"12863169965973415180"}},"colab":{"base_uri":"https://localhost:8080/","height":69}},"source":["print('[INFO] Start processing trainset...')\n","train = get_dataset(dataPath+'trainset.csv', embedder, n_workers=4)     # -----word_dict改成embedder-----\n","print('[INFO] Start processing validset...')\n","valid = get_dataset(dataPath+'validset.csv', embedder, n_workers=4)     # -----word_dict改成embedder-----\n","print('[INFO] Start processing testset...')\n","test = get_dataset(dataPath+'task1_public_testset.csv', embedder, n_workers=4)     # -----word_dict改成embedder-----"],"execution_count":17,"outputs":[{"output_type":"stream","text":["[INFO] Start processing trainset...\n","[INFO] Start processing validset...\n","[INFO] Start processing testset...\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"xf1XoOXTs3w3","colab_type":"text"},"source":["**資料封裝 (Data loader)**  \n","為了更方便的進行batch training，我們將會借助[torch.utils.data.DataLoader](https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader)。  \n","而要將資料放入dataloader，我們需要繼承[torch.utils.data.Dataset](https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset)，撰寫適合這份dataset的class。  \n","`collate_fn`用於batch data的後處理，在`dataloder`將選出的data放進list後會呼叫collate_fn，而我們會在此把sentence padding到同樣的長度，才能夠放入torch tensor (tensor必須為矩陣)。  \n","To easily training in batch, we'll use `dataloader`, which is a function built in Pytorch [torch.utils.data.DataLoader](https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader)  \n","To use datalaoder, we need to packing our data into class `dataset` [torch.utils.data.Dataset](https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset)  \n","`collate_fn` is used for data processing, and we will padding sentence in here."]},{"cell_type":"markdown","metadata":{"id":"GH82DVNThQkl","colab_type":"text"},"source":["# Pseudo code\n","batch size = 32\n","\n","return_data = []\n","\n","**# sample會call ＿＿len＿＿()陳述資料長度，也要告訴他要吐出的batch_size，會回傳隨機選取的data index**\n","\n","sample_index = sample(total=dataset.__len__(), length=batch_size)\n","\n","**# 定義＿＿getitem＿＿()\n","\n","for index in sample_index:\n","\n"," → return_data.append(dataset.__getitem__(index))\n","\n"," **# collate_fn代表需要做資料後處理的函數\n","\n","if collate_fn is not None:\n","\n"," → return_data = collate_fn(return_data)\n","\n","return return_data"]},{"cell_type":"code","metadata":{"id":"m3uauKS1s3w4","colab_type":"code","colab":{}},"source":["\"\"\"\n","Don't forget the data type that tidy up from get_dataset()!! \n","Format: [dict, dict, ...]\n","dict:{\n","  'Abstract': [[4, 5, 6], [3, 4, 2], ...]\n","  'Label': [[0, 0, 0, 1, 1, 0], [1, 0, 0, 0, 1, 0], ...] <-- testing data don't have this\n","}\n","\"\"\"\n","from torch.utils.data import Dataset\n","import torch\n","class AbstractDataset(Dataset):\n","  def __init__(self, data, pad_idx, max_len=500):\n","    self.data = data\n","    self.pad_idx = pad_idx     # padding的數值，設為PAD_TOKEN=0\n","    self.max_len = max_len\n","  def __len__(self):\n","    return len(self.data)\n","  def __getitem__(self, index):\n","    return self.data[index]\n","  # 資料後處理：包裝成相同shape矩陣(不一次全部padding以避免極端值產生)\n","  def collate_fn(self, datas):\n","    \"\"\"\n","    returns:\n","    Tensor(batch, sentence, words) : input data\n","    Tensor(batch, sentence, words) : corresponding answer\n","    list(sentence quantity in each abstract): use in prediction, to remove the redundant sentences (the sentences we padded)\n","    \"\"\"\n","    # get max length in this batch(data為每一篇)，找出此batch最大句子數)\n","    max_sent = max([len(data['Abstract']) for data in datas])\n","    # 每一句最大長度(上限設self.max_len)\n","    max_len = max([min(len(sentence), self.max_len) for data in datas for sentence in data['Abstract']])\n","    batch_abstract = []\n","    batch_label = []\n","    sent_len = []\n","    for data in datas:\n","      # padding abstract to make them in same length(每句超過截斷、不足補0)\n","      pad_abstract = []\n","      for sentence in data['Abstract']:\n","        if len(sentence) > max_len:\n","          pad_abstract.append(sentence[:max_len])\n","        else:\n","          pad_abstract.append(sentence+[self.pad_idx]*(max_len-len(sentence)))\n","      # 原本每篇的句子數量\n","      sent_len.append(len(pad_abstract))\n","      # 補成 相同句子數\n","      pad_abstract.extend([[self.pad_idx]*max_len]*(max_sent-len(pad_abstract)))\n","      batch_abstract.append(pad_abstract)\n","\n","      # gather labels\n","      if 'Label' in data:\n","          pad_label = data['Label']\n","          # label(y)也補成 相同句子數[0, 0, 0, 0, 0, 0]\n","          pad_label.extend([[0]*6]*(max_sent-len(pad_label)))\n","          batch_label.append(pad_label)\n","    # 每個batch摘要, 每個batch的label, 每個batch原本每篇句子數量\n","    return torch.LongTensor(batch_abstract), torch.FloatTensor(batch_label), sent_len"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"TyugmkAjs3w6","colab_type":"code","colab":{}},"source":["trainData = AbstractDataset(train, PAD_TOKEN, max_len=64)\n","validData = AbstractDataset(valid, PAD_TOKEN, max_len=64)\n","testData = AbstractDataset(test, PAD_TOKEN, max_len=64)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"CwtiAwqes3w8","colab_type":"text"},"source":["**Model**  "]},{"cell_type":"markdown","metadata":{"id":"rWa0P89_s3w9","colab_type":"text"},"source":["資料處理完成後，接下來就是最重要的核心部分：`Model`。  \n","此次範例中我們以簡單的一層RNN + 兩層Linear layer(FCN)作為示範。  \n","而為瞭解決每個batch的句子長度不一的問題(`linear layer必須是fixed input size`)，因此我們取所有hidden_state裡, 每一個feature的最大值，讓這一個vector代表這句話，做法可以只取每句最後一個字、每句每個字的向量做pooling(max/mean)\n","\n","每一句(每個字) → RNN(字之間、句子間) → Pooling → FCN FCN → prediction "]},{"cell_type":"markdown","metadata":{"id":"vcfgVFE9s3w_","colab_type":"text"},"source":["In this tutorial, we're going to implement a simple model, which contain one RNN layer and two fully connected layers (Linear layer). Of course you can make it \"deep\".  \n","To solve variant sentence length problem (`input size in linear layer must be fixed`), we can average all hidden_states or doing max pooling, and become one vector. (Perfect!)"]},{"cell_type":"code","metadata":{"id":"zGuZR0ifs3xA","colab_type":"code","colab":{}},"source":["import torch.nn as nn\n","import torch.nn.functional as F\n","\n","class simpleNet(nn.Module):     # 繼承nn.Module，自動跑forward\n","  def __init__(self, vocabulary_size):     # vocabulary_size 傳入 embedder.get_dim()\n","    super(simpleNet, self).__init__()\n","    # self.embedding_size = 50     # embedding幾個維度     # ------拿掉------\n","    self.hidden_dim = 512\n","    # self.embedding = nn.Embedding(vocabulary_size, self.embedding_size)     # ------拿掉------\n","    self.sent_rnn = nn.GRU(vocabulary_size,      # 改掉self.embedding_size,     # 仍是原始embedding維度(input_size)\n","                           self.hidden_dim,     # hidden layers維度(hidden_size)\n","                          #  2,     # num_layers 改2層\n","                           bidirectional=True,     # 雙向\n","                           batch_first=True)\n","    # FCN：雙向第一次input為二倍hidden layers維度\n","    self.l1 = nn.Linear(self.hidden_dim*2, self.hidden_dim)\n","    self.l2 = nn.Linear(self.hidden_dim, 256)\n","    self.l3 = nn.Linear(256, 128)\n","    self.l4 = nn.Linear(128, 6)\n","    self.drop = nn.Dropout(p=0.3)\n","\n","  def forward(self, x):\n","    # # x: (batch, sent, word)\n","    # x = self.embedding(x)     # ------拿掉-----\n","    # x: (batch, sent, word, feature)\n","    b, s, w, e = x.shape\n","    # x: (batch, sent*word, feature) 將同一篇當中所有句子串在一起\n","    x = x.view(b, s*w, e)\n","    # x: (batch, sent*word, hidden_state*2)\n","    x, __ = self.sent_rnn(x)\n","    # x: (batch, sent, word, hidden_state*2)\n","    x = x.view(b, s, w, -1)\n","    # x: (batch, sent, hidden_state*2) max pooling\n","    x = torch.max(x, dim=2)[0]\n","    \n","    x = torch.relu(self.drop(self.l1(x)))\n","    x = torch.relu(self.drop(self.l2(x)))\n","    x = torch.relu(self.drop(self.l3(x)))\n","    x = torch.sigmoid(self.l4(x))\n","    # x: (batch, sent, 6)\n","    return x"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"KpfH3pVxs3xC","colab_type":"text"},"source":["**Training**  \n","指定使用的運算裝置  \n","Designate running device."]},{"cell_type":"code","metadata":{"id":"5UPABKsns3xD","colab_type":"code","colab":{}},"source":["device = 'cuda'"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"DemqkWvzs3xF","colab_type":"text"},"source":["定義計分公式, 讓我們在training能快速瞭解model的效能\n","\n","micro F1 score: multi-label\n","\n","Define score function, let us easily observe model performance while training.  "]},{"cell_type":"code","metadata":{"id":"b0NqkVcas3xG","colab_type":"code","colab":{}},"source":["class F1():\n","  def __init__(self):\n","    self.threshold = 0.5\n","    self.n_precision = 0\n","    self.n_recall = 0\n","    self.n_corrects = 0\n","    self.name = 'F1'\n","\n","  def reset(self):\n","    self.n_precision = 0\n","    self.n_recall = 0\n","    self.n_corrects = 0\n","\n","  def update(self, predicts, groundTruth):\n","    predicts = (predicts > self.threshold).float()\n","    self.n_precision += torch.sum(predicts).data.item()\n","    self.n_recall += torch.sum(groundTruth).data.item()\n","    self.n_corrects += torch.sum(groundTruth * predicts).data.item()\n","\n","  def get_score(self):\n","    recall = self.n_corrects / self.n_recall\n","    precision = self.n_corrects / (self.n_precision + 1e-20)     # prevent divided by zero\n","    return 2 * (recall * precision) / (recall + precision + 1e-20)\n","\n","  def print_score(self):\n","    score = self.get_score()\n","    return '{:.5f}'.format(score)"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"JgiLl8E0s3xJ","colab_type":"code","colab":{}},"source":["import os\n","from tqdm import tqdm_notebook as tqdm\n","# 定義每個epoch如何跑\n","def _run_epoch(epoch, embedding, training):     # -----多了embedding參數-----\n","  model.train(training)     # 可傳入狀態是訓練還是驗證\n","  if training:\n","    description = 'Train'\n","    dataset = trainData\n","    shuffle = True\n","  else:\n","    description = 'Valid'\n","    dataset = validData\n","    shuffle = False\n","  dataloader = DataLoader(dataset=dataset,\n","                          batch_size=32,     # ------64改32-----\n","                          shuffle=shuffle,\n","                          collate_fn=dataset.collate_fn,\n","                          num_workers=4)\n","  # 跑進度視覺化\n","  trange = tqdm(enumerate(dataloader), total=len(dataloader), desc=description)\n","  loss = 0\n","  f1_score = F1()\n","  for i, (x, y, sent_len) in trange:\n","    opt.zero_grad()\n","\n","    x = embedding(x)     # -----增加-----\n","    abstract = x.to(device)     # X\n","    labels = y.to(device)     # y\n","    o_labels = model(abstract)     # 預測y\n","    batch_loss = criteria(o_labels, labels)     # loss\n","\n","    if training:\n","      batch_loss.backward()\n","      opt.step()\n","\n","    loss += batch_loss.item()\n","    f1_score.update(o_labels.cpu(), y)\n","    # 紀錄算分，寫在tqdm\n","    trange.set_postfix(loss=loss/(i+1), f1=f1_score.print_score())\n","  # 訓練結果儲存(f1, loss)\n","  if training:\n","      history['train'].append({'f1': f1_score.get_score(), 'loss': loss/len(trange)})\n","  else:\n","      history['valid'].append({'f1': f1_score.get_score(), 'loss': loss/len(trange)})"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"scrolled":true,"id":"8dTzL36Es3xL","colab_type":"code","colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["6c2bac26e88449249ab56ba56a6fbd8f","b17840bdf2a04da49a4da078848b4e3e","edde3af37fa246f18621aa18a5587f3d","3c02690f6560407a984f90b367d0a315","e90df9fe18214bfb8d18873258ddcf7e","079a46ccb7ca470a8bbd37f368e19bf1","1f344c99a49b4dbd9a5b5933d7b8d159","f3d7c8ff77b74b579bc1549977afb615","e5b8370dbd2048c9b2243cf0f66f6079","53b698ecb1c74c0fbcb532c713879880","eefcb4123f534d5297a5de5c7c69f2bf","69834bc132fc4dcba6d2c752613238b2","56384113d4c046c0a6c7515c7fb3f688","f99a7d0e83314718979337a20137e6fd","41b8d351482647de85508de9563fb9c4","789cb4744bd04dcfbbc257b34d6992b2","565d48d2b06c44d78cea1128176c3636","a01e4b1190bd486cae30f5fae125514a","bf5692f8e0e74b87bec19e556512c09f","ac4bf2cb09a347fc8150e0a8497a1592","8bce549a3b644ff4ac8bd68f5b1ecd7b","e616847924c7407b863e589c2cda3023","30a9b8c2c49141a7a2b700b07f176944","071818c70d2b48fab71ad5fbc4ef4177","73877f5755a0412ea5afe736fa7f0492","60d4cc05d4294616aec963542da06550","5fe23da65850432b8bc5e357f440e808","d4907559ee444cb3b2a9dabb36fd85f1","2afb173a6de241eba3c6b3b9bda31cc7","71ff5b9c8e6a4118a04bbf2fd44d82bf","a96caa803c5049c88e4c82db2516ef7f","97ed13638c744cc2b9a467762e0cb54d","74cbef6e708041f8aaec1d7d04483b96","0001c23f91064c33992ccca9917af115","dd581818b4014cc2add3cd1118e64149","b68e3791cef74fb2a9f77870e74a0092","1d4096620d144617ad61e0d02b117670","ff558b286b7747edba0a6b646a1b0695","0f1b6808c5094e4999300620d3b1aff1","152b077ac53f491bb7f31f074c92faa9","a89c5bf642b54278a423536284eba9c7","a147f61abb684e238d3c4f25f7aa1c50","22d76fa1cabd4a7d9da3a9e9f2c32165","622b9fd9f4a34f50b562ef640eecd996","ebf552e1d93f42df8dc5d49bad97bca8","1bebc95da0814edc94fe60fffec313a0","36fd4c69923d413287aeaf605388b5d6","b849d35b38a147998636db976f2d53b6","936d0488d910458aad521dab2f9f6ec9","c99b676ec00f494599ec00392bb17623","b720e367530844f38129b5903e4652e8","d615f80323a74ab4bef38f15870299ec","f25e73027a664c759cd31a77a7c1b6c6","aedcb940f7be45f9a88d5442dbab0769","af10da4682aa4bdd9be21de9b4209720","75f2c59651354d2696ac36681af66757","b588f65c468a4e37bca2fdea8bf25117","ecbf6f6a38114c4f8416ef470f43dbc6","41045615d2074988b2bc659af05e3067","20317e56aca94a8ba8fecb9511ab471d","5907b68058da42f59fd4d52ec9ca0fdd","2569f35e9bf34113a4870c7ee02a3bb7","bd135357d92b4aa3bc0d3cec64eff896","a0b4d7d5508b4caa935dd07ea68c53bd","b49568217d46478b913ae65b7074ac20","3a99d05ea8114b6281428a23b4c401cd","b312812a1c034ec89e53bd3e6c7651d8","6ad4909e79ac4b34be90dbd1d8040107","508208bc34834b559791e72ae8612a1e","59bfc43be396498ca6e2826911d0eb12","185060860e194e19ad65fa12d7e6009b","5069114a7c4a4a2a9ccd12d0c7257f37","8cd8c29b8fc94f60b509826a41b34a20","76fc90e1f9ac41c581895e4b932e62fe","426537dcdb124a5bb09c5753df816f7a","f19490a09c7c442a815dff3165609f0f","1f5c63b630bd4edaadedd77189490ae4","9f0d5838cb7d4f8cb36baf9900f0ec52","ceb3f0b2348e49ba9e999f1460d1a818","f16a511e59c4464aa6142e8dd4b75309","1ce607689bf04fb997332aa804f59048","f14e184a23304789a7e4fe51b7c9d068","4c9defaf14da44e087e50b041b0a6571","8c068285b4d64a2eb9980ffeb4a030ef","310dda17c34546728c49a665553f79c5","4c8824866b6f4c9c8de467b8556c2b7f","aaa9ca9a0aed45cd9814cc44ed5a5fa6","aa2d942d6fcf4a7688b353f62567db4c","4ab72a76acd641ec87464e26546a34f9","b40d84606ed3450a935b9e3de9eb8a2d","f69a35e8fbeb4dedb1dcc5af5e523f57","a832431821cd4643aa3d0bd2f3bb764e","642a3dd1988b4ef3a2c28a9bdc3ebc8a","bc229923548b40408ec9ab6a644a655b","574cd010c6c847cbb126701a8bffaf24","6c64057d10454a0aa9309ea68221e90d","50dd3ef0393a4e2fad0ae592d4e6aae4","e26ec58fd196481cb6bc065253b85903","0c5661bdafc643dabd7676a090b7b8fb","420fc08e370442d1b09dac836bb716d0","27d267887e7b4556bbe0284ae3be50df","87d1e81d2f4f462e96660dbcdcc45f02","63a553655f2744c68b0b5f864dc50c55","768b8dbe2c3a451b9bcdc6380686c055"]},"outputId":"cb1635ec-9c93-4916-e7d6-c1065ec24a7b","executionInfo":{"status":"error","timestamp":1577299919293,"user_tz":-480,"elapsed":403034,"user":{"displayName":"連國安","photoUrl":"https://lh3.googleusercontent.com/a-/AAuE7mBta7TGONYMKlH0SwAU74zZeMlrtHkQOqtiMoev=s64","userId":"12863169965973415180"}}},"source":["# --------------------以下跑多次挑選模型、參數更改--------------------\n","colab_filename_head = 51\n","colab_filename_end = 52\n","\n","for i in range(colab_filename_head, colab_filename_end):\n","  def save(epoch):\n","    if not os.path.exists(dataPath+'model/'+str(i)):\n","      os.makedirs(dataPath+'model/'+str(i))\n","          \n","    torch.save(model.state_dict(), dataPath+'model/'+str(i)+'/model.pkl.'+str(epoch))\n","    with open(dataPath+'model/'+str(i)+'/history.json', 'w') as f:\n","      json.dump(history, f, indent=4)\n","  \n","  from torch.utils.data import DataLoader\n","  import json\n","  model = simpleNet(embedder.get_dim())     # -----改掉simpleNet(len(word_dict))-----\n","  opt = torch.optim.Adam(model.parameters())\n","  criteria = torch.nn.BCELoss()\n","  model.to(device)\n","  max_epoch = 20\n","  history = {'train': [], 'valid': []}\n","\n","  # -----增加-----\n","  embedding = nn.Embedding(embedder.get_vocabulary_size(), embedder.get_dim())\n","  embedding.weight = torch.nn.Parameter(embedder.vectors)\n","  # -----增加-----\n","  \n","  for epoch in range(max_epoch):\n","    print('Epoch: {}'.format(epoch))\n","    _run_epoch(epoch, embedding, True)     # train     # -----增加embedding參數-----\n","    _run_epoch(epoch, embedding, False)     # validation     # -----增加embedding參數-----\n","    save(epoch)\n","\n","  with open(dataPath+'model/'+str(i)+'/history.json', 'r') as f:\n","      history = json.loads(f.read())\n","  print('Best F1 score ', max([[l['f1'], idx] for idx, l in enumerate(history['valid'])]))"],"execution_count":24,"outputs":[{"output_type":"stream","text":["Epoch: 0\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"6c2bac26e88449249ab56ba56a6fbd8f","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"e5b8370dbd2048c9b2243cf0f66f6079","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Valid', max=22, style=ProgressStyle(description_width='initia…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n","Epoch: 1\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"565d48d2b06c44d78cea1128176c3636","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"73877f5755a0412ea5afe736fa7f0492","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Valid', max=22, style=ProgressStyle(description_width='initia…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n","Epoch: 2\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"74cbef6e708041f8aaec1d7d04483b96","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"a89c5bf642b54278a423536284eba9c7","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Valid', max=22, style=ProgressStyle(description_width='initia…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n","Epoch: 3\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"936d0488d910458aad521dab2f9f6ec9","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"b588f65c468a4e37bca2fdea8bf25117","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Valid', max=22, style=ProgressStyle(description_width='initia…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n","Epoch: 4\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"b49568217d46478b913ae65b7074ac20","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"8cd8c29b8fc94f60b509826a41b34a20","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Valid', max=22, style=ProgressStyle(description_width='initia…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n","Epoch: 5\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"1ce607689bf04fb997332aa804f59048","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"4ab72a76acd641ec87464e26546a34f9","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Valid', max=22, style=ProgressStyle(description_width='initia…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n","Epoch: 6\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"50dd3ef0393a4e2fad0ae592d4e6aae4","version_minor":0,"version_major":2},"text/plain":["HBox(children=(IntProgress(value=0, description='Train', max=197, style=ProgressStyle(description_width='initi…"]},"metadata":{"tags":[]}},{"output_type":"error","ename":"KeyboardInterrupt","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-24-c52894690814>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[1;32m     27\u001b[0m   \u001b[0;32mfor\u001b[0m \u001b[0mepoch\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mrange\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmax_epoch\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     28\u001b[0m     \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'Epoch: {}'\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mformat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mepoch\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 29\u001b[0;31m     \u001b[0m_run_epoch\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mepoch\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0membedding\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;32mTrue\u001b[0m\u001b[0;34m)\u001b[0m     \u001b[0;31m# train     # -----增加embedding參數-----\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     30\u001b[0m     \u001b[0m_run_epoch\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mepoch\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0membedding\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;32mFalse\u001b[0m\u001b[0;34m)\u001b[0m     \u001b[0;31m# validation     # -----增加embedding參數-----\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     31\u001b[0m     \u001b[0msave\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mepoch\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m<ipython-input-23-f10610cf9102>\u001b[0m in \u001b[0;36m_run_epoch\u001b[0;34m(epoch, embedding, training)\u001b[0m\n\u001b[1;32m     31\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     32\u001b[0m     \u001b[0;32mif\u001b[0m \u001b[0mtraining\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 33\u001b[0;31m       \u001b[0mbatch_loss\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbackward\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     34\u001b[0m       \u001b[0mopt\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mstep\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     35\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.6/dist-packages/torch/tensor.py\u001b[0m in \u001b[0;36mbackward\u001b[0;34m(self, gradient, retain_graph, create_graph)\u001b[0m\n\u001b[1;32m    164\u001b[0m                 \u001b[0mproducts\u001b[0m\u001b[0;34m.\u001b[0m \u001b[0mDefaults\u001b[0m \u001b[0mto\u001b[0m\u001b[0;31m \u001b[0m\u001b[0;31m`\u001b[0m\u001b[0;31m`\u001b[0m\u001b[0;32mFalse\u001b[0m\u001b[0;31m`\u001b[0m\u001b[0;31m`\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    165\u001b[0m         \"\"\"\n\u001b[0;32m--> 166\u001b[0;31m         \u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mautograd\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbackward\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgradient\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mretain_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcreate_graph\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    167\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    168\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mregister_hook\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mhook\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.6/dist-packages/torch/autograd/__init__.py\u001b[0m in \u001b[0;36mbackward\u001b[0;34m(tensors, grad_tensors, retain_graph, create_graph, grad_variables)\u001b[0m\n\u001b[1;32m     97\u001b[0m     Variable._execution_engine.run_backward(\n\u001b[1;32m     98\u001b[0m         \u001b[0mtensors\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgrad_tensors\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mretain_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 99\u001b[0;31m         allow_unreachable=True)  # allow_unreachable flag\n\u001b[0m\u001b[1;32m    100\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    101\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}]},{"cell_type":"code","metadata":{"id":"9IPCML0myzZu","colab_type":"code","colab":{}},"source":["# # 讀取多個記錄檔繪圖\n","# from torch.utils.data import DataLoader\n","# import json\n","# model = simpleNet(len(word_dict))\n","# opt = torch.optim.Adam(model.parameters())\n","# criteria = torch.nn.BCELoss()\n","# model.to(device)\n","\n","# maxscore = []\n","# start_file = 41\n","# end_file = 51\n","# for i in range(start_file, end_file):\n","#   # 畫出histry檔\n","#   import matplotlib.pyplot as plt\n","#   %matplotlib inline\n","\n","#   with open(dataPath+'model/'+str(i)+'/history.json', 'r') as f:\n","#       history = json.loads(f.read())\n","      \n","#   # train_loss = [l['loss'] for l in history['train']]\n","#   # valid_loss = [l['loss'] for l in history['valid']]\n","#   # train_f1 = [l['f1'] for l in history['train']]\n","#   # valid_f1 = [l['f1'] for l in history['valid']]\n","\n","#   # plt.figure(figsize=(7, 5))\n","#   # plt.title('Loss')\n","#   # plt.plot(train_loss, label='train')\n","#   # plt.plot(valid_loss, label='valid')\n","#   # plt.legend()\n","#   # plt.show()\n","\n","#   # plt.figure(figsize=(7, 5))\n","#   # plt.title('F1 Score')\n","#   # plt.plot(train_f1, label='train')\n","#   # plt.plot(valid_f1, label='valid')\n","#   # plt.legend()\n","#   # plt.show()\n","  \n","#   print('Best F1 score ', max([[l['f1'], idx] for idx, l in enumerate(history['valid'])]))\n","#   maxscore.append(max([[l['f1'], idx] for idx, l in enumerate(history['valid'])]))\n","\n","# print('最高分 =', max([i[0] for i in maxscore]))\n","# print('最高分資料夾 =', np.argmax(np.array(([i[0] for i in maxscore]))) + 41)\n","# print('最低分 =', min([i[0] for i in maxscore]))\n","# print('最低分資料夾 =', np.argmin(np.array(([i[0] for i in maxscore]))) + 41)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"0ndxm6R7s3xS","colab_type":"text"},"source":["**Plot Learning Curve**  "]},{"cell_type":"code","metadata":{"id":"aBIC6eXQs3xS","colab_type":"code","colab":{}},"source":["# # 畫出單一histry檔\n","# import json\n","# import matplotlib.pyplot as plt\n","# %matplotlib inline\n","\n","# filename = 43\n","# with open(dataPath+'model/'+str(filename)+'/history.json', 'r') as f:\n","#     history = json.loads(f.read())\n","# print('Best F1 score ', max([[l['f1'], idx] for idx, l in enumerate(history['valid'])]))\n","    \n","# train_loss = [l['loss'] for l in history['train']]\n","# valid_loss = [l['loss'] for l in history['valid']]\n","# train_f1 = [l['f1'] for l in history['train']]\n","# valid_f1 = [l['f1'] for l in history['valid']]\n","\n","# plt.figure(figsize=(7, 5))\n","# plt.title('Loss')\n","# plt.plot(train_loss, label='train')\n","# plt.plot(valid_loss, label='valid')\n","# plt.legend()\n","# plt.show()\n","\n","# plt.figure(figsize=(7, 5))\n","# plt.title('F1 Score')\n","# plt.plot(train_f1, label='train')\n","# plt.plot(valid_f1, label='valid')\n","# plt.legend()\n","# plt.show()"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"ACtyMea_NXnB","colab_type":"text"},"source":["**Choose your best model according to learning graph**\n","\n","已經訓練好儲存的model叫出表現最好的那一組"]},{"cell_type":"code","metadata":{"id":"0Oo3NsRoB-k_","colab_type":"code","colab":{}},"source":["# from torch.utils.data import DataLoader\n","# import json\n","# model = simpleNet(embedder.get_dim())     # -----len(word_dict)改embedder.get_dim()-----\n","# opt = torch.optim.Adam(model.parameters())\n","# criteria = torch.nn.BCELoss()\n","# model.to(device)\n","# embedding = nn.Embedding(embedder.get_vocabulary_size(),embedder.get_dim())\n","# embedding.weight = torch.nn.Parameter(embedder.vectors)\n","\n","# best_file = 43\n","# best_epoch = 3\n","# model.load_state_dict(torch.load(dataPath+'model/'+str(best_file)+'/model.pkl.'+str(best_epoch)))"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"J1Vn5fdos3xM","colab_type":"text"},"source":["**Predict**  "]},{"cell_type":"code","metadata":{"scrolled":true,"id":"DjYZqo3ws3xN","colab_type":"code","colab":{}},"source":["# model.train(False)\n","# # 資料封裝成每個batch：回傳結果前面已經定義\n","#   # 每個batch摘要, 每個batch的label, 每個batch原本每篇句子數量\n","# _run_epoch(1, embedding, False)     # -----增加-----\n","# dataloader = DataLoader(dataset=testData, \n","#                         batch_size=128,     # -----改128-----\n","#                         shuffle=False, \n","#                         collate_fn=testData.collate_fn, \n","#                         num_workers=4)\n","# # iterable=None, desc=None進度條的Prefix, total=None預期的iterations數量，沒有就是len(iterable)\n","# trange = tqdm(enumerate(dataloader), total=len(dataloader), desc='Predict')\n","# prediction = []\n","# for i, (x, y, sent_len) in trange:\n","#   x = embedding(x)     # -----增加-----\n","#   o_labels = model(x.to(device))\n","#   o_labels = o_labels > 0.5     # threshold\n","#   for idx, o_label in enumerate(o_labels):     # 轉回句子真正數量\n","#     prediction.append(o_label[:sent_len[idx]].to('cpu'))     # 根據idx找到句子真正長度\n","# # torch.cat為PyTorch的concat\n","# prediction = torch.cat(prediction).detach().numpy().astype(int)"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"FPIDfsDps3xP","colab_type":"code","colab":{}},"source":["# # 預測檔案上傳固定格式\n","# \"\"\"\n","# sampleFile 為 上傳檔案範例(task1_sample_submission.csv)，直接讀入\n","# Public = True if you're predicting public test data.\n","# \"\"\"\n","# import numpy as np\n","# def SubmitGenerator(prediction, sampleFile, public=True, filename=dataPath+'submission/task1_submission.csv'):\n","#     sample = pd.read_csv(sampleFile)\n","#     submit = {}\n","#     submit['order_id'] = list(sample.order_id.values)\n","#     redundant = len(sample) - prediction.shape[0]\n","#     if public:\n","#       submit['BACKGROUND'] = list(prediction[:, 0]) + [0]*redundant\n","#       submit['OBJECTIVES'] = list(prediction[:, 1]) + [0]*redundant\n","#       submit['METHODS'] = list(prediction[:, 2]) + [0]*redundant\n","#       submit['RESULTS'] = list(prediction[:, 3]) + [0]*redundant\n","#       submit['CONCLUSIONS'] = list(prediction[:, 4]) + [0]*redundant\n","#       submit['OTHERS'] = list(prediction[:, 5]) + [0]*redundant\n","#     else:\n","#       submit['BACKGROUND'] = [0]*redundant + list(prediction[:, 0])\n","#       submit['OBJECTIVES'] = [0]*redundant + list(prediction[:, 1])\n","#       submit['METHODS'] = [0]*redundant + list(prediction[:, 2])\n","#       submit['RESULTS'] = [0]*redundant + list(prediction[:, 3])\n","#       submit['CONCLUSIONS'] = [0]*redundant + list(prediction[:, 4])\n","#       submit['OTHERS'] = [0]*redundant + list(prediction[:, 5])\n","#     df = pd.DataFrame.from_dict(submit) \n","#     df.to_csv(filename, index=False)\n","\n","# SubmitGenerator(prediction, dataPath+'task1_sample_submission.csv', True, dataPath+'submission/task1_submission'+str(best_file)+'.csv')"],"execution_count":0,"outputs":[]}]}
